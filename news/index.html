<!DOCTYPE html>
<html>
<head>
<meta content='IE=edge' http_equiv='X-UA-Compatible'>
<meta charset='utf-8'>
<meta content='width=device-width,initial-scale=1' name='viewport'>
<link href='/images/apple-touch-icon-57x57-4fdb8100.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-114x114-0ba5c2b3.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/images/apple-touch-icon-72x72-d9371b56.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-144x144-bd467b10.png' rel='apple-touch-icon-precomposed' sizes='144x144'>
<link href='/images/apple-touch-icon-60x60-9165d8af.png' rel='apple-touch-icon-precomposed' sizes='60x60'>
<link href='/images/apple-touch-icon-120x120-63f5f0ae.png' rel='apple-touch-icon-precomposed' sizes='120x120'>
<link href='/images/apple-touch-icon-76x76-1025d1ab.png' rel='apple-touch-icon-precomposed' sizes='76x76'>
<link href='/images/apple-touch-icon-152x152-a2a52576.png' rel='apple-touch-icon-precomposed' sizes='152x152'>
<link href='/images/favicon-196x196-0b47bb9f.png' rel='icon' sizes='196x196' type='image/png'>
<link href='/images/favicon-96x96-d739a671.png' rel='icon' sizes='96x96' type='image/png'>
<link href='/images/favicon-32x32-77e1cfca.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/images/favicon-16x16-4aa60318.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/images/favicon-128-6e4707f8.png' rel='icon' sizes='128x128' type='image/png'>
<meta content='Ruma' name='application-name'>
<meta content='#FFFFFF' name='msapplication-TileColor'>
<meta content='/images/mstile-144x144-bd467b10.png' name='msapplication-TileImage'>
<meta content='/images/mstile-70x70-6e4707f8.png' name='msapplication-square70x70logo'>
<meta content='/images/mstile-150x150-d5f0b5e6.png' name='msapplication-square150x150logo'>
<meta content='/images/mstile-310x150-e8749e81.png' name='msapplication-wide310x150logo'>
<meta content='/images/mstile-310x310-ed20b880.png' name='msapplication-square310x310logo'>
<title>This Week in Ruma</title>
<meta content='Ruma is a collection of Matrix applications and libraries written in the Rust programming language.' name='description'>
<link href='https://www.ruma.io/news/' rel='canonical'>
<link href='/news/feed.atom' rel='alternate' type='application/atom+xml'>
<link href="/stylesheets/site-21a986c4.css" rel="stylesheet" />
</head>
<body class='news news_index'>
<nav class='navbar navbar-inverse navbar-static-top'>
<div class='container-fluid'>
<ul class='nav navbar-nav navbar-right'>
<li><a href="/" title="Home">Home</a></li>
<li><a href="/news/" title="News">News</a></li>
<li><a href="/status/" title="Project Status">Project Status</a></li>
<li><a href="/projects/" title="Projects">Projects</a></li>
<li><a href="/contributing/" title="How to Contribute">How to Contribute</a></li>
<li><a href="https://liberapay.com/ruma/" title="Donate to Ruma">Donate on Liberapay</a></li>
<li><a href="/docs/" title="Documentation">Documentation</a></li>
</ul>
</div>
</nav>

<div class='container'>
<div class='row'>
<div class='col-md-8 col-md-offset-2'>
<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jonas Platte' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/ruma-is-dead-long-live-ruma-2020-04-10/" title="Ruma is dead, long live Ruma!">Ruma is dead, long live Ruma!</a>
<small itemprop='datePublished' value='2020-04-10'>April 10, 2020</small>
</h1>
<p>
<small>by Jonas Platte</small>
</p>
<p>
<strong>Ruma</strong> is a <a href="https://matrix.org">Matrix</a> homeserver, client, and supporting libraries written in the <a href="https://www.rust-lang.org/">Rust</a> programming language. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
</p>
</header>
<p>Today, I have a bit of a sad announcement to make:</p>

<h2 id="ruma-the-homeserver-wont-be-developed-anymore">Ruma, the homeserver, won't be developed anymore</h2>

<p>To those who have actively been following the project, this probably won't be a
big surprise, given the homeserver's readme file was already update do note the
missing maintenance and people interested in contributing to the homeserver have
now gathered around a new homeserver project by the name of <a href="https://conduit.rs/">Conduit</a>.</p>

<p>The main reason for ending homeserver development is that nobody who has
previously worked on its codebase is currently able to guide and review work on
it. The codebase has also bit-rotted a lot, with the web framework it uses being
almost un-maintained and a number of its other dependencies having seen major
new releases since the most recent commit; it also doesn't build on
ruma-client-api, for the simple reason that ruma-client-api simply didn't exist
yet when most of the homeserver work happened.</p>

<p>However, the end of the homeserver does not at all mean the end of Ruma, the
overall project.</p>

<h2 id="the-future-of-ruma-the-project">The future of Ruma, the project</h2>

<p>We will be continuing work on our library crates, making sure they are usable
for all kinds of applications, including homeservers. The new homeserver project
mentioned at the beginning is based on them and some other folks are currently
working on <a href="https://github.com/matrix-org/matrix-rust-sdk">a highlevel client library</a>, also using many of
Ruma's library crates.</p>

<p>I am planning to replace the current website with a new one, mostly for
technical reasons, but the new one will also reflect our changed focus. This
work hasn't started yet, but in the interim I will likely update parts of the
current site. Other than that, nothing will really be different compared to last
year.</p>

<h2 id="if-you-are-still-interested-in-a-rust-homeserver">If you are still interested in a Rust homeserver</h2>

<p>… then check out <a href="https://conduit.rs/">Conduit</a>. It is a Matrix homeserver, written in Rust using
Ruma's library crates. It is focused on experimenting with new ideas to achieve
better performance, for example by using <a href="https://sled.rs/">sled</a> as its database. The goal is
to make it as easy as possible to set up your own homeserver.</p>


</article>

<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jonas Platte' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/these-weeks-in-ruma-2019-12-14/" title="These Weeks in Ruma">These Weeks in Ruma</a>
<small itemprop='datePublished' value='2019-12-14'>December 14, 2019</small>
</h1>
<p>
<small>by Jonas Platte</small>
</p>
<p>
<strong>Ruma</strong> is a <a href="https://matrix.org">Matrix</a> homeserver, client, and supporting libraries written in the <a href="https://www.rust-lang.org/">Rust</a> programming language. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
</p>
</header>
<p>There's been steady progress since the last news entry, so I thought I'd write a small progress
update again.</p>

<p>These crates saw a new release:</p>

<ul>
  <li>ruma-api-macros 0.9.0 (with an alpha beforehand)</li>
  <li>ruma-api 0.12.0 (with an alpha beforehand)</li>
  <li>ruma-client-api 0.5.0</li>
  <li>ruma-client 0.3.0-beta.2</li>
  <li>ruma-identifiers 0.14.1</li>
</ul>

<h2 id="what-changed">What changed?</h2>

<p>The biggest thing that changed is that the temporary non-support of server-side usage of ruma-api
that I wrote about last time has ended. Restoring server-side support also required some changes to
ruma-client-api, but those were rather minimal because all of the additional logic that deals with
the client / server side distinction is hidden away in ruma-api(-macros).</p>

<p>Moreover, ruma-client now has no more dependencies with alpha or beta versions, and will have its
0.3.0 release soon (pending a small update from hyper). ruma-identifiers now supports historical
user IDs, which are user IDs can't actually be created on a matrix homeserver because they contain
invalid characeters, but nevertheless have to be supported because older versions of the
specification allowed these characters and as such some users still have them in their IDs.</p>

<h2 id="server-side-support">Server-side support</h2>

<p>To support fallible deserialization on both ends of the protocol, the request-sending /
response-receiving side (when dealing with the client-server protocl, this is the client) and the
request-receiving / response-sending side (the server) now use different types if request or
response structs contain events. For every <code>Request</code> or <code>Response</code> that contains an event (or
another struct that contains another struct that contains a <code>Vec</code> of events and such) we now
generate a corresponding <code>IncomingRequest</code> / <code>IncomingResponse</code>. The non-<code>Incoming</code> structs don't
use ruma-events' <code>EventResult</code> type, while the <code>Incoming</code> types do.</p>

<p>For details about how these new structs are generated, see the <a href="https://docs.rs/ruma-api/0.12.0/ruma_api/derive.Outgoing.html">documentation for the new <code>Outgoing</code>
derive macro</a>.</p>

</article>

<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jonas Platte' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/new-releases-2019-11-05/" title="New releases">New releases</a>
<small itemprop='datePublished' value='2019-11-05'>November 05, 2019</small>
</h1>
<p>
<small>by Jonas Platte</small>
</p>
<p>
<strong>Ruma</strong> is a <a href="https://matrix.org">Matrix</a> homeserver, client, and supporting libraries written in the <a href="https://www.rust-lang.org/">Rust</a> programming language. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
</p>
</header>
<p>Last week, we uploaded 7 (!) new versions of our crates to crates.io:</p>

<ul>
  <li>ruma-events-macros 0.2.0</li>
  <li>ruma-events 0.15.0</li>
  <li>ruma-events 0.15.1 (bugfix release because ruma-events 0.15.0 was released a tad too early)</li>
  <li>ruma-api-macros 0.8.0</li>
  <li>ruma-api 0.11.0</li>
  <li>ruma-client-api 0.4.0</li>
  <li>ruma-client 0.3.0-beta.1</li>
</ul>

<h2 id="what-changed">What changed?</h2>

<p>A quick overview:</p>

<ul>
  <li>ruma-events 0.15 improves event deserialization and validation</li>
  <li>the latest ruma-api &amp; ruma-client-api are only useable for implementing client-side stuff, server-side functionality will be added back in a later release</li>
  <li>ruma-client 0.3.0-beta.1 supports async/await, the final version will be published after its dependencies are final too</li>
</ul>

<p>And now to the technical details…</p>

<h2 id="fallible-event-deserialization">Fallible event deserialization</h2>

<p>The most important change is one in ruma-events, and it is <em>the</em> reason all of the other crates saw a new release too. ruma-events 0.15.0 introduces a type <code>EventResult&lt;T&gt;</code>, which is almost the same as <code>Result&lt;T, ruma_events::InvalidEvent&gt;</code> (and it is in fact convertible to that) but with one important difference: It implements <code>serde::Deserialize</code> in a different way. Deserializing an <code>EventResult&lt;T&gt;</code> almost always succeeds. It tries to deserialize the <code>T</code>, and if that fails, falls back to <code>serde_json::Value</code> deserialization. However, in contrast to the fallback one would get with <code>Result&lt;T, serde_json::Value&gt;</code> deserialization which is supported by serde directly, we also capture the error message from <code>T</code>s deserialization… or validation:</p>

<h2 id="event-validation">Event validation</h2>

<p>I left out one detail in the previous section, and that is that the <code>T</code> in <code>EventResult&lt;T&gt;</code> doesn't actually need to implement <code>Deserialize</code>. Instead, it needs to implement <code>TryFromRaw</code>. This trait is very similar to <code>TryFrom</code> from the standard library, and in fact we would have used <code>TryFrom</code> directly, were it not for coherence issues¹. This trait is implemented for every event (content) type in ruma-events and allows conversion of a private raw version of that type, which does implement <code>Deserialize</code>, to the actual event (content) type. All of this is done to enable validation of events during deserialization, without having to write the actual deserialization code manually. There are currently few events that need this validation step after deserialization (most of the constraints the matrix spec puts on json fields beyond their types are captured in their Rust types, e.g. using <code>UserId</code> instead of <code>String</code>), but it is nevertheless useful to have the required mechanisms in place.</p>

<p>¹ <a href="https://github.com/rust-lang/rust/issues/55437">RFC 2451</a> "Re-Rebalancing Coherence" might allow us to switch to <code>TryFrom</code> in a future release, though I have not tested this yet</p>

<h2 id="temporary-non-support-of-server-side-usage">Temporary non-support of server-side usage</h2>

<p>Because of the whole fallible deserialization thing, we might not be able to use the same Rust types on both client &amp; server anymore. Due to that and the server not being worked on currently, we decided to temporarily remove request deserialization and response serialization from ruma-api and ruma-api-macros, leaving request serialization and response deserialization, as needed for the client use case. This affects ruma-client-api as well, through its use of the aforementioned crates.</p>

<h2 id="asyncawait-in-ruma-client">Async/await in ruma-client</h2>

<p>As listed at the beginning, we published ruma-client 0.3.0-beta.1. This release supports <code>async</code> / <code>await</code> syntax in addition to using all the latest lower-level ruma crates. While <code>async</code> / <code>await</code> will become stable with Rust 1.39.0 on 2019-11-09, tokio 0.2.0 is expected to take some more time to come out, which will in turn affect hyper 0.13.0's final release and thus our 0.3.0 release. Nevertheless, ruma-client 0.3.0-beta.1 can be used today on Rust beta or nightly.</p>


</article>

<nav>
<ul class='ruma-pagination'>
<li>Page 1</li>
<li>
<a href="/news/page/2/" rel="next">Next</a>
<span>&rarr;</span>
</li>
</ul>
</nav>
</div>
</div>
</div>

<footer class='ruma-footer'>
<div class='container-fluid'>
<ul class='nav'>
<li><a href="https://github.com/ruma">GitHub</a></li>
<li><a href="https://twitter.com/ruma_io">Twitter</a></li>
<li><a href="https://matrix.to/#/#ruma:matrix.org">Matrix room</a></li>
</ul>
</div>
</footer>
<div class='container-fluid'>
<p class='text-center'>
<small>
The source code and content of this website are free and available under the MIT license:
<a href="https://github.com/ruma/ruma.github.io">www.ruma.io</a>
</small>
</p>
</div>
</body>
</html>
